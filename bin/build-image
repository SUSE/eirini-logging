#!/bin/bash

set -euo pipefail

GIT_ROOT=${GIT_ROOT:-$(git rev-parse --show-toplevel)}
. "${GIT_ROOT}/bin/include/versioning"

BASEDIR="$(cd "$(dirname "$0")/.." && pwd)"
DOCKER_ORG="${DOCKER_ORG:-}"
DOCKER_IMAGE="${DOCKER_IMAGE:-${DOCKER_ORG}/eirini-logging:latest}"

curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl && \
  chmod +x ./kubectl && mv ./kubectl ${BASEDIR}/binaries/kubectl

docker build --rm --no-cache -t "${DOCKER_IMAGE}" ${BASEDIR}
